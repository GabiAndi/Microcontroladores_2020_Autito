#ifndef INC_TICKER_H_
#define INC_TICKER_H_

/**********************************************************************************/
/*********************************** Includes *************************************/
/**********************************************************************************/
#include <inttypes.h>
/**********************************************************************************/
/**********************************************************************************/
/**********************************************************************************/

/**********************************************************************************/
/*********************************** Defines **************************************/
/**********************************************************************************/

/****************************** Tickers como maximo *******************************/
#define TICKER_MAX_USE                 					15
/**********************************************************************************/

/***************************** Prioridad del ticker *******************************/
#define TICKER_LOW_PRIORITY								0	// Prioridad baja (se ejecuta en blucle principal)
#define TICKER_HIGH_PRIORITY							1	// Prioridad alta (se ejecuta en interrupcion)
/**********************************************************************************/

/******************************* Estado del ticker ********************************/
#define TICKER_NO_ACTIVE								0
#define TICKER_ACTIVE									1
/**********************************************************************************/

/**********************************************************************************/
/**********************************************************************************/
/**********************************************************************************/

/**********************************************************************************/
/*********************************** Typedef **************************************/
/**********************************************************************************/

/******************* Puntero a funcion a ejecutar en el ticker ********************/
typedef void(*ticker_ptrfun)(void);
/**********************************************************************************/

/******************************* Estructura ticker ********************************/
typedef struct
{
	uint32_t ms_max;
	volatile uint32_t ms_count;

	volatile uint16_t calls;

	uint8_t active;

	uint8_t priority;

	ticker_ptrfun ticker_function;
}ticker_t;
/**********************************************************************************/

/**********************************************************************************/
/**********************************************************************************/
/**********************************************************************************/

/**********************************************************************************/
/********************************** Funciones *************************************/
/**********************************************************************************/

/*
 * Funcion que configura los tickers
 *
 * Se debe llamar una sola vez y antes de cualquier accion relacionada a un ticker.
 *
 */
void ticker_init_core(void);

/*
 * Funcion que crea un nuevo ticker
 *
 */
void ticker_new(ticker_t *ticker);

/*
 * Funcion que borra un ticker
 *
 */
void ticker_delete(ticker_t *ticker);

/*
 * Funcion que ejecuta los tickers de baja prioridad
 *
 */
void ticker_execute_pending(void);
/**********************************************************************************/
/**********************************************************************************/
/**********************************************************************************/

#endif /* INC_TICKER_H_ */
